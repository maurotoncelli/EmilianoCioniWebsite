import { useEffect, useRef } from 'react';

export default function Preloader() {
  const loaderRef = useRef(null);

  useEffect(() => {
    // Wait for GSAP to be loaded
    const checkGSAP = () => {
      if (typeof window !== 'undefined' && window.gsap) {
        const tlLoad = window.gsap.timeline();
        
        // Get horseshoes elements and reverse them
        const horseshoes = Array.from(document.querySelectorAll('.horseshoes .cls-1')).reverse();
        
        tlLoad
          .to('.cls-1:not(.horseshoes .cls-1)', {
            opacity: 1,
            y: 0,
            duration: 1,
            stagger: 0.05,
            ease: 'power2.out'
          })
          .to(horseshoes, {
            opacity: 1,
            y: 0,
            duration: 1,
            stagger: 0.05,
            ease: 'power2.out'
          }, '-=0.8')
          .to(loaderRef.current, {
            y: '-100%',
            duration: 1,
            ease: 'power4.inOut',
            delay: 0.5,
            onComplete: () => {
              // Animate hero text after preloader finishes
              if (window.gsap) {
                const tlHero = window.gsap.timeline();
                tlHero
                  .to('.hero-sub', { y: 0, opacity: 1, duration: 1, ease: 'power3.out' })
                  .to('.hero-main', { y: 0, opacity: 1, stagger: 0.2, duration: 1.2, ease: 'power3.out' }, '-=0.8')
                  .to('.hero-cta-wrap', { y: 0, opacity: 1, duration: 1, ease: 'power2.out' }, '-=0.5');
              }
            }
          });
      } else {
        // Retry after a short delay if GSAP not loaded yet
        setTimeout(checkGSAP, 50);
      }
    };
    
    checkGSAP();
  }, []);

  return (
    <div
      ref={loaderRef}
      className="loader fixed top-0 left-0 w-full h-screen bg-black z-[99999] flex justify-center items-center flex-col"
    >
      <svg
        id="Livello_2"
        data-name="Livello 2"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 113.16 67.92"
        className="w-[300px] max-w-[90vw] h-auto overflow-visible mb-0"
      >
        <defs>
          <style>{`.cls-1 { fill: #fff; opacity: 0; transform-origin: center; }`}</style>
        </defs>
        <g>
          <path className="cls-1" d="M34.29,25.3v-1.81l2.26-.2.6-.58V2.97l-.6-.52-2.26-.18V.45h18.68v5.81h-2.57l-.63-3.26-.4-.49h-7.42v8.83h4.83l.51-.52.38-2.66h2.19v8.59h-2.19l-.38-2.68-.51-.51h-4.83v9.62h8.65l.43-.6.6-3.92h2.55v6.64h-19.9Z"/>
          <path className="cls-1" d="M78.88,24.42c-1.24.45-2.51.78-3.81,1-1.3.22-2.62.33-3.97.33s-2.55-.14-3.71-.43-2.19-.7-3.11-1.26c-1.93-1.15-3.44-2.7-4.52-4.68s-1.63-4.14-1.63-6.5c0-1.89.33-3.65.99-5.26.66-1.62,1.61-3.02,2.87-4.21,1.17-1.13,2.54-1.99,4.1-2.56C67.64.29,69.39,0,71.32,0c1.24,0,2.49.11,3.75.34,1.26.23,2.53.57,3.81,1.03v6.19s-2.71,0-2.71,0l-.74-3.96-.51-.63c-.51-.18-1-.32-1.49-.42-.49-.1-.97-.14-1.44-.14-2.58,0-4.63.94-6.14,2.81-1.51,1.88-2.27,4.42-2.27,7.64s.79,5.89,2.37,7.76c1.58,1.87,3.76,2.8,6.53,2.8.3,0,.64-.03,1.02-.09.38-.06.79-.14,1.22-.25l.56-.56.89-4.47h2.71s0,6.37,0,6.37Z"/>
        </g>
        <g>
          <polygon className="cls-1" points="19.02 66.09 19.01 66.09 19.01 66.09 19.02 66.09"/>
          <polygon className="cls-1" points="33.75 66.09 33.74 66.09 33.74 66.09 33.75 66.09"/>
          <polygon className="cls-1" points="48.94 66.09 48.93 66.09 48.93 66.09 48.94 66.09"/>
          <polygon className="cls-1" points="63.67 66.09 63.66 66.09 63.66 66.09 63.67 66.09"/>
          <polygon className="cls-1" points="78.86 66.09 78.85 66.09 78.85 66.09 78.86 66.09"/>
          <polygon className="cls-1" points="94.05 66.09 94.04 66.09 94.04 66.09 94.05 66.09"/>
          <polygon className="cls-1" points="109.23 66.09 109.23 66.09 109.23 66.09 109.23 66.09"/>
          <g>
            <path className="cls-1" d="M4.33,66.81v1.06H0v-6.24h4.25v1.06H1.21v1.5h2.63v.98H1.21v1.63h3.12Z"/>
            <path className="cls-1" d="M13.88,67.87v-4.13l-1.61,3.07h-.66l-1.61-3.07v4.13h-1.21v-6.24h1.3l1.84,3.55,1.86-3.55h1.29v6.24h-1.21Z"/>
            <path className="cls-1" d="M19.91,67.87v-6.24h1.21v6.24h-1.21Z"/>
            <path className="cls-1" d="M25.93,67.87v-6.24h1.21v5.17h3.18v1.06h-4.39Z"/>
            <path className="cls-1" d="M34.58,67.87v-6.24h1.21v6.24h-1.21Z"/>
            <path className="cls-1" d="M42.38,61.63h1.07l2.37,6.24h-1.25l-.58-1.55h-2.18l-.57,1.55h-1.25l2.38-6.24ZM43.77,65.46l-.86-2.45-.9,2.45h1.76Z"/>
            <path className="cls-1" d="M51.23,63.87v4h-1.21v-6.24h.94l3.25,4.09v-4.08h1.21v6.23h-.98l-3.21-4Z"/>
            <path className="cls-1" d="M62.9,67.91c-.46,0-.87-.09-1.24-.27-.37-.18-.69-.42-.96-.71-.27-.3-.47-.63-.62-1.01-.15-.38-.22-.77-.22-1.17s.08-.81.23-1.19c.16-.38.37-.72.64-1.01.27-.29.6-.53.97-.7.37-.17.78-.26,1.22-.26s.86.09,1.23.28.69.43.95.72c.26.3.47.64.61,1.02.15.38.22.77.22,1.16,0,.42-.08.81-.23,1.19-.15.38-.36.71-.63,1-.27.29-.59.52-.97.69-.37.17-.78.26-1.22.26ZM61.09,64.75c0,.27.04.53.12.78.08.25.2.47.36.67.16.19.35.35.57.47.23.12.48.18.77.18s.55-.06.78-.18c.23-.12.42-.28.57-.48.16-.2.27-.42.35-.67.08-.25.12-.5.12-.76s-.04-.53-.13-.78c-.08-.25-.21-.47-.36-.67-.16-.19-.35-.35-.57-.46-.23-.11-.48-.17-.76-.17s-.55.06-.78.18c-.23.12-.42.28-.57.47-.15.2-.27.42-.35.67-.08.25-.12.5-.12.76Z"/>
            <path className="cls-1" d="M75.64,64.71c0-.38.07-.76.21-1.13.14-.37.34-.7.6-1,.26-.29.59-.53.97-.71.38-.18.81-.27,1.3-.27.57,0,1.07.13,1.49.38.42.25.73.58.94.98l-.93.64c-.08-.18-.18-.32-.3-.44s-.24-.22-.38-.29c-.13-.07-.28-.12-.42-.15-.15-.03-.29-.05-.43-.05-.3,0-.57.06-.8.18-.23.12-.41.28-.56.48-.15.2-.26.42-.34.67-.08.25-.11.5-.11.74,0,.28.04.54.13.79.09.25.21.48.37.67.16.19.35.35.58.47.23.12.47.18.74.18.14,0,.29-.02.44-.05s.3-.09.43-.17c.14-.08.26-.17.38-.29.12-.12.21-.26.28-.43l.99.57c-.1.23-.24.44-.43.62-.18.18-.39.33-.62.45-.23.12-.48.22-.74.28s-.52.1-.77.1c-.45,0-.85-.09-1.22-.28-.37-.19-.69-.43-.95-.73-.27-.3-.47-.64-.62-1.03-.15-.38-.22-.77-.22-1.17Z"/>
            <path className="cls-1" d="M85.55,67.87v-6.24h1.21v6.24h-1.21Z"/>
            <path className="cls-1" d="M94.24,67.91c-.46,0-.87-.09-1.24-.27-.37-.18-.69-.42-.96-.71-.27-.3-.47-.63-.62-1.01-.15-.38-.22-.77-.22-1.17s.08-.81.23-1.19c.16-.38.37-.72.64-1.01s.6-.53.97-.7c.37-.17.78-.26,1.22-.26s.86.09,1.23.28c.37.18.69.43.95.72.26.3.47.64.61,1.02.15.38.22.77.22,1.16,0,.42-.08.81-.23,1.19-.15.38-.36.71-.63,1-.27.29-.59.52-.97.69-.37.17-.78.26-1.22.26ZM92.43,64.75c0,.27.04.53.12.78.08.25.2.47.36.67.16.19.35.35.57.47.23.12.48.18.77.18s.55-.06.78-.18c.23-.12.42-.28.57-.48s.27-.42.35-.67.12-.5.12-.76-.04-.53-.13-.78c-.09-.25-.21-.47-.36-.67-.16-.19-.35-.35-.57-.46-.23-.11-.48-.17-.76-.17s-.55.06-.78.18c-.23.12-.42.28-.57.47-.15.2-.27.42-.35.67-.08.25-.12.5-.12.76Z"/>
            <path className="cls-1" d="M102.95,63.87v4h-1.21v-6.24h.94l3.25,4.09v-4.08h1.21v6.23h-.98l-3.21-4Z"/>
            <path className="cls-1" d="M111.95,67.87v-6.24h1.21v6.24h-1.21Z"/>
          </g>
        </g>
        <g className="horseshoes">
          <path className="cls-1" d="M6.55,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67C2.51,39.22,0,40.09,0,42.78s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="6.32 45.03 6.32 45.03 6.33 45.03 6.32 45.03"/>
          <path className="cls-1" d="M20.01,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="19.78 45.03 19.78 45.03 19.79 45.03 19.78 45.03"/>
          <path className="cls-1" d="M33.06,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="32.83 45.03 32.83 45.03 32.84 45.03 32.83 45.03"/>
          <path className="cls-1" d="M46.51,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="46.29 45.03 46.29 45.03 46.29 45.03 46.29 45.03"/>
          <path className="cls-1" d="M59.97,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="59.74 45.03 59.74 45.03 59.75 45.03 59.74 45.03"/>
          <path className="cls-1" d="M73.43,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="73.2 45.03 73.2 45.03 73.21 45.03 73.2 45.03"/>
          <path className="cls-1" d="M86.48,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="86.25 45.03 86.25 45.03 86.26 45.03 86.25 45.03"/>
          <path className="cls-1" d="M99.93,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="99.71 45.03 99.71 45.03 99.71 45.03 99.71 45.03"/>
          <path className="cls-1" d="M112.98,45.69h0c.11-.06.18-.18.18-.31,0-.2-.16-.36-.36-.36-.02,0-.03,0-.05,0-.17.02-.39.07-.7.14-1.19.29-2.51.47-3.51-.25-1-.72-1.08-1.8-1.08-2.14s.08-1.4,1.08-2.12,2.31-.55,3.51-.25c.3.08.53.12.7.14.02,0,.03,0,.05,0,.2,0,.36-.16.36-.36,0-.13-.07-.25-.18-.31h0c-.63-.34-2.24-.68-3.03-.67-1,0-3.52.87-3.52,3.57s2.51,3.58,3.52,3.58c.79,0,2.4-.33,3.03-.67Z"/>
          <polygon className="cls-1" points="112.76 45.03 112.76 45.03 112.76 45.03 112.76 45.03"/>
        </g>
      </svg>
    </div>
  );
}
